<%- include('partials/header') -%>
<div>
  <% if (messages.groupCreateSuccess) { %>
    <div class="alert alert-success shadow-lg">
      <div>
        <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current flex-shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
        <span><%= messages.groupCreateSuccess %></span>
      </div>
    </div>
  <% } %>

  <% if (messages.success) { %>
    <div class="alert alert-success shadow-lg">
      <div>
        <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current flex-shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
        <span><%= messages.success %></span>
      </div>
    </div>
  <% } %>

  <% if (messages.error) { %>
    <div class="alert alert-error shadow-lg">
      <div>
        <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current flex-shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
        <span><%= messages.error %></span>
      </div>
    </div>
  <% } %>
  <h3 class="text-2xl">Account Info</h3>
  <p><strong>User Name</strong>: <%= user.userName %></p>
  <p><strong>Email</strong>: <%= user.email %></p>
</div>
<div class="grid grid-cols-12 mt-4">

  <!-- List of Reviews by each member of group. One for each member -->
  <div class="col-span-10">
      <div class="">

        <div>
          <form action="/groups/addMember/<%= group._id %>?_method=PUT" method="POST">
            <div class="form-control w-full max-w-xs">
                <label for="username" class="label">Member Username</label>
                <input type="text" placeholder="Add Member" class="input input-bordered input-primary w-full max-w-xs" id="username" name="username">
            </div>
            <button type="submit" class="btn btn-primary mt-2">Add Member</button>
          </form>

          <%if(group.createdBy == user.id){ %>
          <form
            action="/groups/deleteGroup/<%= group.id %>?_method=DELETE"
            method="POST"
            class="col-3"
          >
            <button class="btn btn-primary mt-2" type="submit">Delete Group</button>
          </form>
          <%}%>
        </div>
          <div>
              <p><strong>Group Name</strong>: <%= group.groupName %></p>
              <p><strong>Group Description</strong>: <%= group.groupDescription %></p>
             
              <ul class="grid lg:grid-cols-2 2xl:grid-cols-3 place-items-center">
                <% for(var j=0; j<group.members.length; j++) {%>
                 <li class="mt-5">
                   <div class="card w-96 bg-base-300 shadow-xl">
                      <figure><img src="<%= group.members[j].posts[0].image%>" alt="review-card-image" /></figure>
                     <div class="card-body">
                       <a href="/post/<%= group.members[j].posts[0].id%>">
                         <h2 class="card-title"><%=group.members[j].posts[0].title%></h2>
                       </a>
                       <a href="/post/show/<%= group.members[j]._id%>" class="link link-accent">
                        <h3 class="card-title text-base">By <%=group.members[j].userName%></h2>
                      </a>

                      <!-- Review Badge and Rating  -->
                      <div>
                        <div class="badge badge-secondary"><%= group.members[j].posts[0].category %></div>
                        <ul class="rating rating-lg rating-half">
                          <% for(var k=1; k <= 10; k++) {%>
                            <% if (k % 2 == 0 && k <= group.members[j].posts[0].rating) { %>
                              <li class="bg-yellow-500 mask mask-star-2 mask-half-2">&nbsp;&nbsp;</li>
                          <% } %>
  
                            <% if (k % 2 != 0 && k <= group.members[j].posts[0].rating) { %>
                              <li class="bg-yellow-500 mask mask-star-2 mask-half-1">&nbsp;&nbsp;</li>
                          <% } %>
  
                            <% if (k % 2 == 0 && k > group.members[j].posts[0].rating) { %>
                              <li class="bg-gray-500 mask mask-star-2 mask-half-2">&nbsp;&nbsp;</li>
                          <% } %>
  
                            <% if (k % 2 != 0 && k > group.members[j].posts[0].rating) { %>
                              <li class="bg-gray-500 mask mask-star-2 mask-half-1">&nbsp;&nbsp;</li>
                          <% } %>
  
                          <% } %>
                        </ul>
                      </div>
                       <p><%=group.members[j].posts[0].summary%></p>
                       <div class="card-actions justify-end">
                         <a href="/post/<%= group.members[j].posts[0]._id %>" class="btn btn-primary">Read Review</a>
                       </div>
                     </div>
                   </div>
                 </li>
               <% } %>
             </ul>   
          </div>
         
        </div>  
    </div>

    <!-- Group Members Section on Right of Page -->
    <div class="overflow-x-auto col-span-2">
      <p class="text-center"><strong>Group Members</strong></p>
      <table class="table w-full">
        <!-- head -->
        <thead>
          <tr>
            <th>No.</th>
            <th>Username</th>
            <th># of Reviews</th>
          </tr>
        </thead>
        <tbody>
          <!-- rows -->
          <% for(var i=0; i < group.members.length; i++) {%>
          <tr class="hover">
            <th><%= i + 1 %></th>
            <td><a href="/post/show/<%= group.members[i]._id %>" class="link link-accent"><%= group.members[i].userName %></a></td>
            <td><%= group.members[i].posts.length %></td>
          </tr>
          <% } %>
        </tbody>
      </table>
    </div>

  </div>
</div>
<%- include('partials/footer') -%>